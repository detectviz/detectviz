# Prompt List 2

- [ ]  引入 `errors` 套件。
- [ ]  補上中英文註解以符合整體風格。
- [ ]  移除原有的 TestMockAlertEvaluator 測試函式，以精確命名區分。
- [ ]  補上中英文註解於 `evaluators` 欄位
- [ ]  為 `Register()` 補充是否覆蓋的判斷與 log 紀錄
- [ ]  增加 logger 欄位以便在註冊時記錄事件
- [ ]  在 `docs/interfaces/alert.md` 中補上 `Operator` 欄位至 `AlertCondition` 表格中。
- [ ]  更新 `預期實作` 區段，補充已支援 operator 比對邏輯，以及 `Evaluate()` 已統一抽出為共用邏輯。
- [ ]  在 `internal/test/testutil/test_logger.go` 中新增一個簡易 `TestLogger` 實作，符合 `logger.Logger` 介面。
- [ ]  提供空方法體，方便在測試中使用但不輸出。
- [ ]  若需記錄 log 可擴充記憶體緩存。
- [ ]  新增 `AssertLogger` 實作，符合 `logger.Logger` 介面。
- [ ]  可用於測試中驗證是否有特定 log 被記錄。
- [ ]  支援記錄所有 log 訊息與級別，可搭配斷言使用。
- [ ]  將測試 logger 改為使用內部共用測試工具 `testutil.NewTestLogger()`。
- [ ]  引入必要的測試工具套件。
- [ ]  補上中英文註解以符合專案測試風格。
- [ ]  移除原有未定義的 `testLogger`。
- [ ]  將測試 logger 替換為共用 `testutil.TestLogger`，並移除原本的 `testlogger` 匯入。
- [ ]  更新註解與風格使其與其他模組一致。
- [ ]  移除內部定義的 testLogger
- [ ]  改為使用共用測試工具 `testutil.NewTestLogger()`
- [ ]  補上 import `"github.com/detectviz/detectviz/internal/test/testutil"`
- [ ]  移除 `testLogger` 類型定義與方法
- [ ]  改用共用測試工具 `testutil.NewTestLogger()` 作為 logger 實例
- [ ]  新增必要的 import
- [ ]  移除 `github.com/detectviz/detectviz/internal/test/mock/logger` 的匯入。
- [ ]  改為使用共用測試工具 `testutil.NewTestLogger()`。
- [ ]  新增匯入 `"github.com/detectviz/detectviz/internal/test/testutil"`。
- [ ]  修改 logger 實例建構方式。
- [ ]  在 `internal/test/README.md` 補上 `assert_logger.go` 的說明。
- [ ]  調整 `testutil/` 區段，說明有哪些可供斷言與觀察的 log 工具。
- [ ]  將 `test_logger.go` 與 `assert_logger.go` 做用途區分。
- [ ]  用途：測試輔助函式與共用模組（logger、時間模擬、預設 context 等）。
- [ ]  範例：
- [ ]  在 `internal/adapters/cachestore/memory/memory.go` 中新增 `MemoryCacheStore` 結構，實作 `CacheStore` interface。
- [ ]  提供 in-memory 快取行為，支援 Get、Set、Has、Delete、Keys。
- [ ]  使用 `sync.Map` 管理資料。
- [ ]  預設 TTL 功能為 No-op，未實作過期邏輯（可擴充）。
- [ ]  新增 `memory_test.go` 單元測試，涵蓋所有 `MemoryCacheStore` 方法：
- [ ]  使用 table-driven 測試與 assert 判斷。
- [ ]  新增 RedisCacheStore 結構，實作 CacheStore interface。
- [ ]  使用 go-redis/v9 客戶端操作 key-value 資料。
- [ ]  提供 Get / Set / Has / Delete / Keys 方法。
- [ ]  註解採中英文雙語風格，保持與專案一致。
- [ ]  在 `redis_test.go` 中加入基本單元測試，驗證 `RedisCacheStore` 的 CRUD 行為。
- [ ]  預設使用本機 Redis（127.0.0.1:6379），無密碼，DB=0。
- [ ]  使用 `testify/assert` 驗證結果，記得啟動 Redis server 再執行測試。
- [ ]  在 `internal/adapters/cachestore/registry.go` 建立快取註冊模組，依據名稱註冊並返回 `CacheStore` 實作。
- [ ]  預設支援 “memory” 與 “redis”，可動態選擇。
- [ ]  構法與 `config.CacheConfig.Backend` 對應，支援擴充。
- [ ]  修改 `memory.MemoryCacheStore` 的 `Delete` 方法簽章以符合 interface 定義。
- [ ]  將其從 `func (m *MemoryCacheStore) Delete(key string)` 改為 `func (m *MemoryCacheStore) Delete(key string) error`。
- [ ]  回傳值固定為 `nil`，與 Redis adapter 行為一致。
- [ ]  修改 `Delete` 方法的簽章與實作，使其符合 `CacheStore` interface。
- [ ]  將 `Delete(key string)` 改為 `Delete(key string) error`，並回傳 `nil`。
- [ ]  將 `Delete` 方法簽章由 `Delete(key string)` 改為 `Delete(key string) error`，以符合 `CacheStore` interface。
- [ ]  回傳 Redis `Del` 操作的錯誤值（若有）。
- [ ]  修改 `Get` 方法簽章，使其回傳 `(string, error)` 而非僅回傳 `string`。
- [ ]  當 key 不存在時，回傳 `("", nil)`；不考慮錯誤情境以簡化記憶體快取邏輯。
- [ ]  修改 `MemoryCacheStore.Keys` 方法簽章，將其回傳改為 `([]string, error)`。
- [ ]  為符合 interface 規格，預設回傳第二個參數 `nil`（表示無錯誤）。
- [ ]  將 `Keys` 方法的簽章由 `Keys(prefix string) []string` 改為 `Keys(prefix string) ([]string, error)`，以符合 interface 規範。
- [ ]  回傳 `nil` 錯誤，與其他方法一致。
- [ ]  修改 `Set` 方法簽章，使其回傳 `error`，TTL 型別由 `int64` 改為 `int`。
- [ ]  將 `Set(key string, value string, ttl int64)` 改為 `Set(key string, value string, ttl int) error`。
- [ ]  方法內部邏輯不變，回傳 `nil`。
- [ ]  將所有 `Get()`、`Set()`、`Delete()`、`Keys()` 呼叫補上 `error` 處理，以符合新的 interface 簽章。
- [ ]  使用 `assert.NoError(t, err)` 驗證不應發生錯誤的情況。
- [ ]  將 `Get()` 結果改為兩個回傳值：值與錯誤。
- [ ]  將 `Keys()` 結果改為兩個回傳值：列表與錯誤。
- [ ]  將 RedisCacheStore 的 `Get`、`Set`、`Keys` 方法簽章修正為符合 `CacheStore` interface：
- [ ]  保留錯誤處理與中文註解風格一致。
- [ ]  修正 `redis_test.go` 中因 RedisCacheStore 簽章改變導致的錯誤：
- [ ]  移除不必要的多重變數接收。
- [ ]  修正 `client.Delete(...)` 與 `store.Set(...)` 的單值回傳使用錯誤。
- [ ]  修正 `store.Delete(...)` 呼叫的多重變數接收錯誤。
- [ ]  將 `_, err = store.Delete(...)` 改為正確的 `err = store.Delete(...)`。
- [ ]  補上雙語註解格式（英文 + zh）以統一風格
- [ ]  新增 `DefaultBackend` 常數
- [ ]  補上 `ErrUnknownBackend` 常數並改善錯誤訊息
- [ ]  未修改原有功能，僅提升可讀性與可維護性
- [ ]  補充 `List()` 方法：列出所有註冊的快取 backend 名稱
- [ ]  補充註解，保持雙語風格一致
- [ ]  新增 `registry_test.go` 測試檔，測試 memory 註冊與 Redis 客製註冊、未知 backend 錯誤處理與 List 列出功能。
- [ ]  使用 `testify/assert` 斷言。
- [ ]  在 `pkg/configtypes/cache_config.go` 新增 `CacheConfig` 結構，用於統一管理快取模組設定。
- [ ]  包含 `Backend`（預設為 memory）與 Redis 相關欄位：Address、Password、DB。
- [ ]  加上雙語註解。
- [ ]  在 `defaultProvider` 中新增 `cacheConfig` 欄位以儲存 `CacheConfig`。
- [ ]  在 `NewDefaultProvider` 中初始化預設 `CacheConfig` 結構。
- [ ]  新增 `GetCacheConfig()` 方法。
- [ ]  新增欄位註解與中文註解保持一致。
- [ ]  建立 `RegisterCacheStore` 函式於 `internal/registry/cachestore/registry.go`。
- [ ]  根據 `config.Provider` 中的快取設定決定註冊哪個後端（memory 或 redis）。
- [ ]  若為 redis，則使用 redis client 並注入 adapter 層。
- [ ]  將 import path 中的 `config` 改為正確的 `configtypes`。
- [ ]  原本的 `config.Provider` 改為 `configtypes.CacheConfig`，因為這裡僅需要 CacheConfig，而非整個 Config Provider。
- [ ]  新增對 CacheStore 註冊的支援。
- [ ]  將 `New()` 函式新增 `cacheCfg configtypes.CacheConfig` 參數，傳入快取設定。
- [ ]  呼叫 `cachestore.RegisterCacheStore(cacheCfg)` 完成注入。
- [ ]  建立 `internal/registry/config/registry.go` 檔案內容。
- [ ]  提供 `RegisterConfigProvider()` 函式，用於初始化並回傳預設的 ConfigProvider。
- [ ]  加上雙語註解，風格與其他 registry 模組一致。
- [ ]  新增 `Config configiface.Provider` 欄位至 `Registry` 結構。
- [ ]  修改 `New()` 函式簽章，加入 `config configiface.Provider` 作為參數。
- [ ]  呼叫 `config.GetCacheConfig()` 傳入 `RegisterCacheStore()`。
- [ ]  保持註解風格一致。
- [ ]  在 `ConfigProvider` interface 中新增 `GetCacheConfig()` 方法。
- [ ]  新增註解（中英對照）說明回傳快取模組設定內容。
- [ ]  新增 `ProvideLogger` 函式，根據指定等級與類型產生 logger 實例。
- [ ]  使用 Zap 預設初始化，如需支援更多類型（如 nop, test）可再擴充。
- [ ]  使用雙語註解，風格與其他 registry 保持一致。
- [ ]  更新 `ProvideLogger` 註解與註釋，使其明確說明所使用的 adapter 為 `internal/adapters/logger/zap_adapter.go`。
- [ ]  加上中英文說明標記，對齊整體風格。
- [ ]  修正 `zap_adapter` 的 import 路徑，從 `github.com/detectviz/detectviz/internal/adapters/logger/zap_adapter` 改為 `github.com/detectviz/detectviz/internal/adapters/logger`。
- [ ]  同步更新程式碼中對 `zap_adapter` 的使用為 `logger`，以符合新 import 名稱。
- [ ]  移動並整理所有事件定義至 `pkg/ifaces/event/types.go`，作為集中定義事件資料結構之處。
- [ ]  保持中英文註解風格一致。
- [ ]  若原先定義散落於 eventbus，可統一搬遷至此檔案。
- [ ]  補上雙語註解說明本介面用途與對應事件定義位置。
- [ ]  註明與 EventBus Dispatcher 結合方式。
- [ ]  補上雙語註解風格，說明介面用途、事件來源與搭配 EventBus 使用情境。
- [ ]  指出事件定義來源 `types.go`。
- [ ]  補上雙語註解說明用途與搭配 EventBus 使用情境。
- [ ]  指明事件資料結構來自 types.go。
- [ ]  補上雙語註解，說明 TaskEventHandler 的使用情境與對應的事件資料結構。
- [ ]  指明事件定義來源為 types.go，風格與其他事件介面保持一致。
- [ ]  建立 `pkg/ifaces/bus/types.go`。
- [ ]  定義 `Envelope` 結構，用於封裝事件資料與傳遞時相關的 metadata。
- [ ]  採用雙語註解格式，與全專案風格一致。
- [ ]  建立 `pkg/ifaces/bus/alert.go`，定義 AlertDispatcher 介面。
- [ ]  採用與其他 bus 模組一致的雙語註解格式。
- [ ]  接收 `context.Context` 與事件物件，回傳錯誤。
- [ ]  建立 `pkg/ifaces/bus/host.go`，定義 HostDispatcher 介面。
- [ ]  採用雙語註解，與 alert.go 格式一致。
- [ ]  引用 `event.HostDiscoveredEvent` 作為傳入事件型別。
- [ ]  在 `pkg/ifaces/bus/metric.go` 中新增 `MetricDispatcher` 介面。
- [ ]  採用與其他 Dispatcher 一致的雙語註解格式。
- [ ]  接收 `context.Context` 與 `MetricOverflowEvent`，回傳 `error`。
- [ ]  新增 `pkg/ifaces/bus/task.go`，定義 TaskDispatcher 介面。
- [ ]  採用與其他 Dispatcher 檔案一致的格式與中英文註解。
- [ ]  將每個事件類型從 `any` 改為對應的明確型別，並從 `pkg/ifaces/event` 匯入。
- [ ]  同時更新註解，指出這些型別來自 event 模組，並符合目前雙語風格。
- [ ]  在每個註解區塊下補上對應實作位置的說明，指向 `internal/adapters/eventbus/inmemory.go`。
- [ ]  保持中英文說明格式一致，與整體風格相符。
- [ ]  建立 `internal/adapters/eventbus/inmemory.go` 檔案。
- [ ]  實作 `EventDispatcher` interface，支援四種事件類型：Alert, Task, Host, Metric。
- [ ]  使用 in-memory slice 儲存 handler，依序呼叫。
- [ ]  採用雙語註解，風格統一。
- [ ]  修改 import：將 `eventbus.AlertTriggeredEvent` 改為正確的 `event.AlertTriggeredEvent`
- [ ]  補上 import `"github.com/detectviz/detectviz/pkg/ifaces/event"`
- [ ]  確保符合事件模組分離的新結構
- [ ]  將 `eventbus.HostDiscoveredEvent` 改為正確來源 `event.HostDiscoveredEvent`
- [ ]  匯入正確的 `event` package
- [ ]  保持註解與實作風格一致
- [ ]  將 `eventbus.MetricOverflowEvent` 替換為正確的 `event.MetricOverflowEvent`。
- [ ]  補上 import `"github.com/detectviz/detectviz/pkg/ifaces/event"`。
- [ ]  將 `eventbus.TaskCompletedEvent` 改為正確的 `event.TaskCompletedEvent`
- [ ]  匯入 `github.com/detectviz/detectviz/pkg/ifaces/event` 以對齊模組設計
- [ ]  建立 `internal/registry/eventbus/registry.go`，實作事件分派器與處理器的註冊流程。
- [ ]  預設使用 `internal/adapters/eventbus/inmemory.go` 作為 Dispatcher。
- [ ]  註冊 4 類型事件處理器：Alert、Task、Host、Metric。
- [ ]  引入 `DispatcherOptions` 結構，支援靜態與擴充式 handler 註冊。
- [ ]  將原本的 `NewInMemoryEventDispatcher()` 改為呼叫 `NewInMemoryEventDispatcherWithOptions()`。
- [ ]  新增 `NewInMemoryEventDispatcherWithOptions()` 函式，用來註冊任意組合的 handler 切片。
- [ ]  新增 plugin 探索與註冊支援。
- [ ]  支援外部模組透過 `RegisterPluginXXXHandler` 註冊自訂事件處理器。
- [ ]  提供 `LoadPluginXXXHandlers` 方法供 registry 呼叫。
- [ ]  在 `NewInMemoryEventDispatcher()` 中，將 opt 的四種 handlers 陣列 append 對應的 plugin handlers。
- [ ]  從 `LoadPluginAlertHandlers()` 等方法載入 plugins.go 中註冊的處理器。
- [ ]  在 `internal/plugins/eventbus/alertlog/alert_handler.go` 建立一個範例 plugin handler，實作 `event.AlertEventHandler`
- [ ]  在 `init()` 函數中註冊此 handler 至 plugin registry
- [ ]  在 `internal/test/plugins/eventbus/alertlog/alert_plugin_test.go` 新增測試，驗證 plugin 註冊是否成功。
- [ ]  測試會透過 `NewInMemoryEventDispatcher` 觸發 alert event，確保不會 panic 或錯誤。
- [ ]  新增測試檔 `alert_handler_test.go`，單元測試 `AlertPluginHandler` 的處理邏輯。
- [ ]  建立 mock 事件並檢查是否正常執行（此版本為 no-op，僅確認無錯）。
- [ ]  新增第二個子測試：檢查 handler 能處理不同嚴重等級。
- [ ]  加入 edge case 測試：空字串與空訊息。
- [ ]  使用 t.Run 分組子測試。
- [ ]  補上 CacheStore 註冊結果並作為欄位存於 Registry 結構中。
- [ ]  將 CacheStore interface 匯入並放入 Registry。
- [ ]  統一註解格式。
- [ ]  修改 `RegisterCacheStore` 回傳型別為 `cachestoreiface.CacheStore`。
- [ ]  根據 config 判斷回傳 redis 或 memory 實作。
- [ ]  匯入 `cachestoreiface`，並新增 `WithMemoryCacheStore()` 的使用。
- [ ]  將 `Has(key string) bool` 修改為 `Has(key string) (bool, error)`，統一所有方法皆可回傳 error。
- [ ]  在註解中補充錯誤處理資訊，並保持中英文格式一致。
- [ ]  將 Has 方法回傳型別從 `bool` 改為 `(bool, error)`，以符合新的 interface 定義。
- [ ]  更新註解對應新的錯誤處理說明。
- [ ]  修改 `Has()` 方法的使用，因應其簽名改為回傳 `(bool, error)`。
- [ ]  在所有調用處補上錯誤處理與 `assert.NoError` 斷言。
- [ ]  更新 `Has` 方法簽名為 `(bool, error)`，以符合 `CacheStore` 介面。
- [ ]  補上註解描述回傳錯誤可能性，與 Redis adapter 一致。
- [ ]  更新所有呼叫 store.Has 的地方，補上錯誤處理，因 Has 現在回傳 (bool, error)。
- [ ]  為每次調用加入 assert.NoError。
- [ ]  調整 `WithRedisClient` 回傳 `cachestore.CacheStore`，以便呼叫端立即使用。
- [ ]  增加 `GetDefault()` 函數，封裝預設 backend 取得邏輯。
- [ ]  在 `RegisterCacheStore` 中修正 `cachestore.WithMemoryCacheStore` 為實際存在的建構函數。
- [ ]  匯入 `internal/adapters/cachestore/memory` 並改為呼叫 `memory.NewMemoryCacheStore()`。
- [ ]  修改 `New()` 方法，加入對 RegisterCacheStore 的錯誤處理。
- [ ]  若註冊失敗，使用 GetDefault() 作為 fallback，並透過 logger.Warn 記錄錯誤。
- [ ]  修正 RegisterCacheStore 調用錯誤：目前只回傳一個值，應移除 err。
- [ ]  同時移除錯誤處理邏輯與 GetDefault 呼叫。
- [ ]  修正 `registry.New()` 的第一個參數錯誤，應傳入 ConfigProvider 而非 notifier config。
- [ ]  確保 Registry 正確初始化並符合函式簽名。
- [ ]  更新註解說明。
- [ ]  在 Init 函數中補上事件總線 plugin 探索與註冊邏輯。
- [ ]  調用 eventbus 探索函數以觸發各插件模組 init。
- [ ]  確保 `eventbus.ExploreEventPlugins` 存在，若不存在，改為呼叫 `eventbus.ExplorePlugins()`（假設這才是正確函式名）。
- [ ]  若未定義 `ExplorePlugins`，需先在 `internal/registry/eventbus/plugins.go` 中定義。
- [ ]  在 `plugins.go` 結尾新增 `ExplorePlugins()` 函數。
- [ ]  此函數導入所有 plugin 模組，藉由 `import _` 觸發各自 `init()` 註冊處理器。
- [ ]  新增 `init.go` 檔案內容，用於在 plugin 載入時註冊 AlertPluginHandler。
- [ ]  導入 eventbus 與 handler，並在 `init()` 中呼叫 `eventbus.RegisterAlertHandler`。
- [ ]  在 `alert.go` 中新增 `alertHandlers` 變數用於儲存 plugin 註冊的 AlertEventHandler。
- [ ]  新增 `RegisterAlertHandler(handler AlertEventHandler)` 函式供 plugin 使用。
- [ ]  新增 `LoadPluginAlertHandlers()` 回傳所有註冊的 handler。
- [ ]  在檔案開頭補上對 `AlertEventHandler` interface 的引用。
- [ ]  引用路徑為 `"github.com/detectviz/detectviz/pkg/ifaces/eventbus"`，以便使用 interface。
- [ ]  將 `alertHandlers` 的型別修正為 `[]eventbus.AlertEventHandler`。
- [ ]  將 `RegisterAlertHandler` 和 `LoadPluginAlertHandlers` 的參數與回傳值型別修正為 `eventbus.AlertEventHandler`。
- [ ]  將 `alertHandlers` 型別從 `[]event.AlertEventHandler` 改為 `[]eventbus.AlertEventHandler`。
- [ ]  更新 `RegisterAlertHandler` 和 `LoadPluginAlertHandlers` 的參數與回傳型別。
- [ ]  補上 `eventbus` package import。
- [ ]  在 `pkg/ifaces/eventbus/eventbus.go` 中新增 `AlertEventHandler` interface。
- [ ]  該 interface 定義 `HandleAlertTriggered` 方法，用於處理 `AlertTriggeredEvent`。
- [ ]  補上繁體中文註解說明其用途與用法。
- [ ]  在 `pkg/ifaces/eventbus/eventbus.go` 中補上其餘 3 種事件的 handler interface：
- [ ]  補上對應註解，與 `AlertEventHandler` 格式一致。
- [ ]  在 `pkg/ifaces/eventbus/eventbus.go` 中補上 `RegisterXHandler` 註冊函式對應的 plugin 使用函式。
- [ ]  分別新增 `RegisterPluginTaskHandler`, `RegisterPluginHostHandler`, `RegisterPluginMetricHandler`。
- [ ]  與 `RegisterAlertHandler` 一致風格，統一供 plugin 使用。
- [ ]  修改 `internal/registry/eventbus/registry.go`，在建立 dispatcher 時自動合併所有 plugin 註冊的事件處理器。
- [ ]  將 `LoadPluginAlertHandlers()` 等整合進 dispatcher 的建構邏輯。
- [ ]  將 `InMemoryDispatcher` 中的事件 handler 型別從 `event.*EventHandler` 統一改為 `eventbus.*EventHandler`。
- [ ]  確保與 interface 定義一致並符合註冊處理器的類型需求。
- [ ]  將 RegisterXXXHandler 的參數型別由 eventbus.*EventHandler 改為 event.*EventHandler。
- [ ]  原因：interface 在 ifaces/eventbus 定義，而具體事件型別在 ifaces/event 中，interface 應依賴 event 的定義。
- [ ]  新增 plugin 註冊機制，仿照 alert.go 的寫法。
- [ ]  增加 RegisterHostHandler 與 LoadPluginHostHandlers 函式。
- [ ]  使用 event.HostEventHandler 型別，與 interface 定義一致。
- [ ]  在 `metric.go` 中補上 plugin 註冊機制：
- [ ]  補上 plugin 註冊支援：`RegisterTaskHandler` 與 `LoadPluginTaskHandlers`
- [ ]  加入對應的 `taskHandlers` 全域變數與註解
- [ ]  補上對 `event` interface 的 import。
- [ ]  加上型別斷言，確保 `AlertPluginHandler` 實作 `AlertEventHandler`。
- [ ]  確保註解與註冊程式碼格式一致。
- [ ]  在 `NewInMemoryEventDispatcher` 函式中，於建立 dispatcher 之前加入 `eventbus.ExplorePlugins()` 呼叫。
- [ ]  確保在載入 handlers 前先載入所有 plugin。
- [ ]  移除 `NewInMemoryEventDispatcher()`。
- [ ]  改為通用建構方式 `NewEventDispatcher(provider string)`。
- [ ]  呼叫 `ExplorePlugins()` 並從 `GetProvider()` 載入 dispatcher。
- [ ]  將原本 `DispatcherOptions` 和 `WithOptions` 保留以供 in-memory provider 使用。
- [ ]  建立 `internal/registry/eventbus/registry_inmemory.go` 並註冊 in-memory eventbus provider。
- [ ]  實作 `DispatcherProvider` interface，名稱為 `"in-memory"`。
- [ ]  在 `init()` 中註冊 provider 供外部載入。
- [ ]  將 `ExplorePlugins()` 補全為靜態引入所有 plugin 模組，以觸發其 init() 註冊邏輯。
- [ ]  每個 plugin 模組使用 `_ import` 強制觸發初始化。
- [ ]  補上清楚的註解說明各模組用途。
- [ ]  將 `alertlog` plugin handler 的註冊方式修正為透過 `eventbus.RegisterAlertHandler`，而非 `RegisterPluginAlertHandler`。
- [ ]  更新 import 路徑為 `internal/adapters/eventbus`，符合目前 plugin 設計使用 adapter 做註冊。
- [ ]  補上 logger 日誌示範處理邏輯。
- [ ]  為所有事件 struct 加入共通欄位 `Timestamp`（事件發生時間）與 `EventID`（唯一識別碼）
- [ ]  保持命名風格一致
- [ ]  加上統一格式註解
- [ ]  在檔案開頭 import 中加入遺漏的 registry 套件路徑：
- [ ]  在 `import` 區塊中移除 `eventbus` 的重複定義。
- [ ]  將 `eventbus` 的 alias 保留一次，例如：
- [ ]  確認 `eventbus.ExplorePlugins()` 來自於 `internal/registry/eventbus/plugins.go`
- [ ]  因此需在此檔案中加入 import：
- [ ]  並將 `eventbus.ExplorePlugins()` 改為 `registry.ExplorePlugins()`
- [ ]  解決 import cycle 問題：
- [ ]  修改 `init.go` 將 `eventbus.ExplorePlugins()` 的呼叫改為 `registryeventbus.ExplorePlugins()`，以解決 import cycle。
- [ ]  新增 import：
- [ ]  保留原有初始化邏輯與註解一致性。
- [ ]  加入缺漏的 import：
- [ ]  將檔案 `internal/registry/registry.go` 的 package 名稱由 `eventbus` 修正為 `registry`。
- [ ]  修正錯誤 import，將 `eventbus` 相關的邏輯保留在實作內容中，但檔案層級應屬於 `registry`。
- [ ]  此修正避免與其他 `eventbus` 專屬模組產生混淆。
- [ ]  在 `internal/registry/registry.go` 中新增 `NewKafkaEventDispatcher()` 範本函式。
- [ ]  加入說明註解，預留未來 Kafka handler 整合邏輯。
- [ ]  將第 18 行的 `registry.Registry` 改為正確的型別名稱 `registry.RegistryContainer`
- [ ]  將第 20 行的 `registry.New` 改為 `registry.NewRegistry` 以對應正確工廠函式名稱
- [ ]  從 `NewInMemoryEventDispatcher()` 中移除 `registryeventbus.ExplorePlugins()` 呼叫，避免重複探索。
- [ ]  將重複的 handler 註冊邏輯抽出為 `registerAllHandlers(d eventbusiface.EventDispatcher)` 函式，供多個 Dispatcher 共用。
- [ ]  更新 `NewInMemoryEventDispatcher()` 及 `NewKafkaEventDispatcher()` 使用此共用註冊邏輯。
- [ ]  將 `registryeventbus.ExplorePlugins()` 呼叫移除，避免與 `registry.NewInMemoryEventDispatcher()` 內部重複。
- [ ]  本檔案僅負責初始化元件與註冊模組，不執行 plugin 探索。
- [ ]  在 `internal/registry/registry.go` 中新增 `RegistryContainer` 結構，用於包裝 Dispatcher 等註冊模組。
- [ ]  實作 `NewRegistry` 函式，初始化 `RegistryContainer`，目前先僅注入 InMemoryEventDispatcher。
- [ ]  對 `NewKafkaEventDispatcher` 保留原本註解，明確標註未實作。
- [ ]  擴充 `RegistryContainer`，新增欄位：
- [ ]  更新 `NewRegistry` 建構器，整合 `schedulerregistry`, `notifierregistry`, `cachestoreregistry`
- [ ]  加入必要 import。
- [ ]  為 `RegisterCacheStore` 函式增加註解說明
- [ ]  補強 Redis client 初始化錯誤處理（使用 `Ping` 驗證是否成功連線）
- [ ]  將快取實作註冊訊息寫入 log（假設未來可注入 logger）
- [ ]  在 `notifier/registry.go` 中新增一個對外介面函式 `ProvideNotifier()`，統一傳回整合後的 Notifier 實例。
- [ ]  此函式接收 `[]configtypes.NotifierConfig` 與 `logger.Logger`，回傳單一 `notifieriface.Notifier`。
- [ ]  若無可用實作，則回傳 `notifier.NewNopNotifier()`。
- [ ]  在 `internal/adapters/notifier/multi.go` 中新增 `MultiNotifier` 實作。
- [ ]  提供 `NewMultiNotifier()` 建構器，用來整合多個 Notifier。
- [ ]  實作 `Notify()` 方法，依序呼叫每個 Notifier。
- [ ]  新增 `internal/adapters/notifier/nop.go` 檔案內容。
- [ ]  實作 `NopNotifier`，符合 `notifieriface.Notifier` 介面。
- [ ]  提供建構函式 `NewNopNotifier()`，回傳一個不執行任何通知的 Notifier。
- [ ]  在 `Notifier` interface 中新增 `Notify(title, message string) error` 方法，對應多數簡易通道用法。
- [ ]  調整註解風格，確保 `Send` 和 `Notify` 方法都有中英文說明。
- [ ]  保留 `Send(ctx, msg)` 為進階用途。
- [ ]  為 MultiNotifier 實作 Name() 方法，回傳組合型 Notifier 名稱。
- [ ]  加入補充註解，保持註解格式與其他檔案一致。
- [ ]  在 `internal/adapters/notifier/multi.go` 的 `MultiNotifier` 中補上 `Send()` 方法實作。
- [ ]  `Send()` 接收完整 `Message` 結構，依序呼叫每個內部 Notifier 的 `Send()` 方法。
- [ ]  與 `Notify()` 行為一致，僅回傳最後一個錯誤（如有）。
- [ ]  補上 `Name()` 方法，回傳 “nop”
- [ ]  補上 `Send()` 方法，忽略所有輸入並回傳 nil
- [ ]  讓 `NopNotifier` 完整符合 Notifier 介面定義
- [ ]  在 `NopNotifier` 中補上 `Notify(title, message string) error` 方法，使其實作完整 `Notifier` 介面。
- [ ]  與 `Send()` 一樣，此方法僅回傳 `nil`，不執行任何操作。
- [ ]  將 `notifier.NewMultiNotifier(list...)` 修改為正確的介面建構方式。
- [ ]  引入具名導入：`notifieradapter "github.com/detectviz/detectviz/internal/adapters/notifier"`。
- [ ]  將 `notifier.NewMultiNotifier` 改為 `notifieradapter.NewMultiNotifier`。
- [ ]  同樣將 `notifier.NewNopNotifier` 改為 `notifieradapter.NewNopNotifier`。
- [ ]  新增 `Notify(title, message string) error` 方法至 `EmailNotifier`，以符合 Notifier 介面
- [ ]  在 `Notify` 方法中呼叫 `Send()`，建構簡單訊息內容
- [ ]  加入 `TODO` 提醒：未來要設定 default target 或透過 config 傳入
- [ ]  為 `SlackNotifier` 實作 `Notify(title, message string) error` 方法
- [ ]  此方法組裝簡單的 Message 結構後呼叫 `Send()` 傳送通知
- [ ]  使用預設 Target，日後可從設定檔注入
- [ ]  為 WebhookNotifier 實作 `Notify(title, message string) error` 方法
- [ ]  新增註解說明，與其他 Notifier 實作一致
- [ ]  使用固定 target 值，後續可從設定檔中注入
- [ ]  更新測試描述與註解風格，明確標示用途。
- [ ]  驗證 plugin 是否成功註冊，並檢查實際 log 是否能捕捉（目前僅示意）。
- [ ]  可未來擴充為更嚴謹的 log/assert 驗證。
- [ ]  匯入 testLogger 模組以攔截日誌輸出
- [ ]  在註冊 plugin 前設定可被 plugin 使用的 log 實例
- [ ]  檢查 plugin 處理完是否產生期望日誌訊息
- [ ]  在 `internal/registry/eventbus/plugins.go` 中新增可注入與取得 plugin logger 的支援。
- [ ]  加入全域變數 `defaultLogger` 與函式 `OverrideDefaultLogger(log logger.Logger)`、`GetDefaultLogger()`。
- [ ]  將 `NewNopLogger()` 回傳實例從 `logger.NopLogger{}` 改為本地定義
- [ ]  在 `nop_adapter.go` 中補上 `NopLogger` 的方法實作以符合 `logger.Logger` interface
- [ ]  將 `logger.NewNopLogger()` 替換為正確命名空間 `adapterlogger.NewNopLogger()`，避免 undefined 錯誤。
- [ ]  加入對應 import：
- [ ]  將變數初始化修正為：
- [ ]  為 `TestLogger` 新增訊息收集機制，用於單元測試時驗證輸出內容。
- [ ]  補上 `Messages()` 方法以回傳訊息列表。
- [ ]  在各級 log 方法中將訊息紀錄進 `messages` 切片。
- [ ]  補上 thread-safe 實作（使用 `sync.Mutex` 保護 messages）。
- [ ]  新增 `logger` 使用說明與注入機制
- [ ]  補充 `TestLogger` 可與 `plugins.go` 結合使用
- [ ]  清楚說明如何在 plugin 測試中覆寫預設 logger
- [ ]  置於「擴充建議」章節下方新增子章節「Logger 設定與測試輔助」
- [ ]  `internal/test/testutil/test_logger.go`
- [ ]  `internal/test/plugins/eventbus/alertlog/alert_plugin_test.go`
- [ ]  補強開頭摘要，總結介面設計意圖與結構
- [ ]  增補「結構說明」中各欄位型別與用途，提升可讀性
- [ ]  清理標點與 markdown 結構，統一格式風格
- [ ]  明確標記共用邏輯集中於 evaluate.go
- [ ]  接收 `AlertCondition` 作為輸入
- [ ]  呼叫注入的 `MetricQueryAdapter` 查詢資料
- [ ]  根據條件比較結果回傳 `AlertResult`
- [ ]  由排程器或事件觸發時，批次執行多筆條件檢查
- [ ]  可於測試階段透過 Mock Adapter 驗證評估邏輯
- [ ]  生產環境可共用一套評估器，但對接不同資料來源（如 Prometheus、InfluxDB 等）
- [ ]  輸入：`AlertCondition`（條件 ID、Expr、閾值、標籤等）
- [ ]  輸出：`AlertResult`（是否觸發、訊息、實際值）
- [ ]  建立檔案：`internal/adapters/metrics/{source}_adapter.go`
- [ ]  實作方法：`Query(ctx, expr, labels) (float64, error)`
- [ ]  包裝對應查詢語法（PromQL、Flux、SQL、API…）並解析為數值
- [ ]  若查詢結果須特殊處理（如比對多欄位、進行統計），可建立專屬 `AlertEvaluator`
- [ ]  例如：`fluxEvaluator := NewEvaluator(fluxAdapter)`
- [ ]  於 `bootstrap/init.go` 中依資料來源或環境設定注入對應實作
- [ ]  評估器由 `AlertScheduler` 控制執行時機
- [ ]  結果可拋給 `EventDispatcher` 通知對應管道
- [ ]  下層資料查詢使用統一介面 `MetricQueryAdapter`，可自由替換與擴充
- [ ]  可於任意 adapter 中共用 `pkg/ifaces/alert/evaluate.go` 實作運算
- [ ]  補充開頭摘要段落，統整設計目的與應用場景
- [ ]  明確補充每個介面預期用途
- [ ]  調整部分欄位說明語意與一致性
- [ ]  將「實作位置與結構對應」改為更具導引意義的「Adapter 結構對應」
- [ ]  `SimpleAggregator`：支援 `sum`、`avg`、`min`、`max` 等基本統計運算
- [ ]  實作位置：`aggregator.go`
- [ ]  實作對應 interface 並放入 `internal/adapters/metrics/`
- [ ]  保持一個 adapter 僅實作一種行為（查詢、寫入、轉換、聚合）
- [ ]  測試邏輯可使用 Mock adapter 快速驗證（建議放置於同檔案末或 `internal/test`）
- [ ]  補上摘要說明與標準格式
- [ ]  統一欄位說明與小節順序
- [ ]  將所有檔案路徑以反引號與 `.go` 結尾標示清楚
- [ ]  加入標準化「結構說明」與「擴充建議」
- [ ]  抽象化通知機制，支援多種傳送通道（如 email, webhook, slack）
- [ ]  支援訊息格式、通知等級、推送目標等欄位封裝
- [ ]  可由 alert 模組、scheduler 模組、eventbus 模組觸發使用
- [ ]  易於擴充與動態註冊
- [ ]  搭配 logger 記錄成功與錯誤資訊
- [ ]  告警觸發時由 AlertEvaluator 推送通知
- [ ]  任務完成後由 Scheduler 發送執行結果
- [ ]  系統異常時透過 EventBus 發送通知
- [ ]  可於 plugin 中擴充事件通知行為
- [ ]  設定來源：`pkg/configtypes/notifier_config.go`
- [ ]  動態註冊位置：`internal/registry/notifier/registry.go`
- [ ]  支援多個 notifier 並以 `[]configtypes.NotifierConfig` 批次註冊
- [ ]  可注入 logger 與自定義 http client
- [ ]  `logger`：記錄通知發送與錯誤
- [ ]  `eventbus`：事件觸發來源
- [ ]  `alert` / `scheduler`：主要呼叫來源
- [ ]  `configtypes.NotifierConfig`：指定通道參數與開關
- [ ]  補強文件開頭的摘要描述
- [ ]  將標題與段落調整為一致的語氣與風格
- [ ]  加入語意更明確的小節分隔
- [ ]  統整並強化關聯模組與測試建議的表達
- [ ]  支援 info/warn/error/debug 等 log level
- [ ]  結構化欄位輸出，利於後續檢索與分析
- [ ]  搭配 context 傳遞 trace_id、span_id 等追蹤資訊
- [ ]  可擴充為 OTLP 格式，對應 Loki、Tempo 等觀測系統
- [ ]  `bootstrap.Init()` 時注入核心元件與 adapter
- [ ]  Middleware 中記錄 HTTP 請求與 trace 資訊
- [ ]  Background task、scheduler、event handler 中紀錄執行流程與錯誤
- [ ]  可與 `WithFields()` 搭配記錄告警與業務欄位資訊
- [ ]  `Debug/Info/Warn/Error`：輸出對應等級的訊息
- [ ]  `WithFields`：加入結構化欄位（例如告警模組的 rule_id、host）
- [ ]  `WithContext`：保留 context 資訊（trace_id 等）
- [ ]  `Named`：指定模組名稱
- [ ]  `Sync`：flush buffer（zap 需明確呼叫）
- [ ]  可於 middleware 注入 logger 實例供後續存取
- [ ]  `FromContext` 在未注入時會回傳 fallback 的 `NopLogger`
- [ ]  可與 OpenTelemetry trace context 整合，實現 log-trace 關聯
- [ ]  支援接入 OTLP 匯出，整合 Loki、Tempo 等後端
- [ ]  plugin 可指定不同 logger backend（如 file, stdout, Redis）
- [ ]  logger 實例可注入並從 context 中擷取
- [ ]  ZapLogger 可輸出結構化欄位與多級訊息
- [ ]  NopLogger 可調用且不產生錯誤
- [ ]  未注入時，FromContext 回傳 fallback logger
- [ ]  使用 `zaptest/observer` 檢查 logger 輸出
- [ ]  使用標準 `testing` 驗證 interface 契約與 fallback 行為
- [ ]  補強摘要與背景，說明 scheduler 模組角色與整體定位
- [ ]  增加 logger 注入與 retry 支援的描述
- [ ]  統一格式，明確區分 interface / usage / registry / test / extension
- [ ]  明示如何註冊替換其他 scheduler 類型
- [ ]  抽象化任務調度邏輯
- [ ]  支援多種排程策略（如 Cron、Worker Pool）
- [ ]  任務具備命名、週期（spec）與執行邏輯
- [ ]  支援注入 logger 與 retry 機制
- [ ]  易於單元測試與擴充其他排程器實作
- [ ]  定時資料清理任務
- [ ]  定期健康檢查與狀態回報
- [ ]  指標彙整與轉拋（例如送出至其他系統）
- [ ]  延遲與重試任務（例如任務失敗時重新排程）
- [ ]  `logger`：可注入日誌紀錄任務執行與錯誤
- [ ]  `eventbus`：任務完成後可發出事件
- [ ]  `config`：可支援未來以動態設定排程行為
- [ ]  補強開頭摘要與用途背景
- [ ]  修正實作檔案命名（與實際專案中一致）
- [ ]  補充 logger 注入與動態註冊說明
- [ ]  明確區分 interface、使用情境、實作、擴充建議等章節
- [ ]  加入與 configtypes 配置結合的說明段落
- [ ]  統一快取操作接口，避免不同模組重複實作快取邏輯
- [ ]  可支援多種後端（如 memory、Redis、Nop）
- [ ]  提供測試用無狀態快取，以簡化測試流程
- [ ]  可依據模組需求擴充 TTL、key namespace、動態註冊等能力
- [ ]  掃描模組快取設備辨識結果，避免重複查詢
- [ ]  快取自動部署結果（如 conf 註記）
- [ ]  Web UI 儲存快照狀態或快取選單資料
- [ ]  排程器記憶任務執行狀態避免重複執行
- [ ]  設定由 `pkg/configtypes/cache_config.go` 提供
- [ ]  註冊邏輯於 `internal/registry/cachestore/registry.go`
- [ ]  可根據 config 中指定類型自動切換對應實作
- [ ]  支援 logger 注入以監控快取行為與錯誤
- [ ]  所有實作皆應具備對應 `_test.go` 單元測試
- [ ]  可使用 `MockCacheStore` 進行介面驗證
- [ ]  建議將測試實作放於與 adapter 相同目錄下或 `internal/test`
- [ ]  若需支援分散式環境，可實作 Redis Cluster adapter
- [ ]  若需監控命中率，可加入統計與 trace log 機制
- [ ]  可考慮支援 JSON / struct 序列化版本，以簡化應用層邏輯
- [ ]  補強摘要與整體用途描述
- [ ]  明確標題統一風格
- [ ]  增加「模組位置」、「測試建議」、「擴充建議」等章節，統一與其他 interface 文件風格
- [ ]  統一用語（如回傳 → 傳回）
- [ ]  解耦設定讀取來源與核心邏輯（YAML、ENV、Remote 等）
- [ ]  避免硬編碼與全域變數污染
- [ ]  支援 hot-reload（視實作而定）
- [ ]  提供良好測試性（可注入 Mock 設定來源）
- [ ]  支援擴充（如套用 Config Schema、版本控制）
- [ ]  在 `internal/bootstrap/init.go` 中初始化後注入各核心模組
- [ ]  子模組可透過 `Get`、`GetInt`、`GetBool` 取得配置參數
- [ ]  搭配 logger、notifier、scheduler 等模組進行動態設定注入
- [ ]  測試時可替換為 Fake 或 Map-based 實作
- [ ]  `Get`：傳回指定 key 的字串值，若不存在回空字串
- [ ]  `GetInt`：傳回整數值，無法解析時預設為 0
- [ ]  `GetBool`：傳回布林值，支援 “true”/“false” 字串轉換
- [ ]  `GetOrDefault`：若指定 key 無值，則傳回提供的 default 值
- [ ]  `Reload`：重新載入設定來源，若支援 hot-reload 機制
- [ ]  可透過注入 `FakeConfigProvider` 模擬錯誤或邊界值
- [ ]  建議單元測試涵蓋 `Reload` 行為與 fallback 邏輯
- [ ]  結合整合測試驗證模組是否正確依據 config 行為切換
- [ ]  可整合 Config Schema，支援欄位驗證與版本轉換
- [ ]  搭配熱更新模組（如 fsnotify）實現自動 reload
- [ ]  與遠端設定中心（如 Consul、etcd、Spring Cloud Config）整合
- [ ]  規劃支援 json-schema-version，可提升未來 JSON 設定相容性管理
- [ ]  建立 `docs/interfaces/bus.md` 文件，補充 EventBus 拆分後的獨立說明，並對齊其他 interface 文件格式。
- [ ]  包含摘要、設計目的、介面定義、實作位置、擴充建議與測試策略。
- [ ]  將事件處理機制從各模組中抽離，統一交由 `Bus` 處理
- [ ]  可支援同步或非同步的事件投遞模式
- [ ]  降低模組間耦合性，提升擴充性與測試性
- [ ]  支援註冊多個處理器與事件分類
- [ ]  發送 `AlertTriggeredEvent` 通知對應模組產生告警紀錄
- [ ]  發送 `MetricOverflowEvent` 進行即時告警評估
- [ ]  發送 `TaskCompletedEvent` 通知後續任務系統
- [ ]  可用於事件擴充如：Webhook、Kafka、Slack 插件
- [ ]  可透過 `internal/registry/eventbus/plugins.go` 自動註冊 plugins
- [ ]  plugin 可實作 `AlertEventHandler` 並透過 `eventbus.RegisterAlertHandler()` 註冊
- [ ]  預設可替換為其他實作（如 Kafka、Channel-based）
- [ ]  實作 `MockEventDispatcher` 測試發送與註冊行為
- [ ]  測試註冊多個 handler 並驗證是否全部觸發
- [ ]  搭配 `TestLogger` 驗證事件投遞流程
- [ ]  `event`：定義各類事件的資料結構
- [ ]  `logger`：事件觸發與失敗時紀錄操作狀態
- [ ]  `notifier`：最終可連接通知模組
- [ ]  新增 `docs/interfaces/event.md` 文件，說明事件類型與 handler 設計原則
- [ ]  統一風格，補充使用情境與測試建議
- [ ]  定義各種監控情境下可能產生的事件類型
- [ ]  每種事件皆有對應 Handler interface，供 EventBus 呼叫
- [ ]  可支援未來擴充更多事件類型（如 UserEvent, ReportEvent）
- [ ]  避免硬編碼與不一致資料傳遞格式
- [ ]  評估告警時產生 `AlertTriggeredEvent` 並通知處理器
- [ ]  掃描設備新增時觸發 `HostRegisteredEvent` 記錄並回報
- [ ]  發現異常值時觸發 `MetricOverflowEvent` 串聯至告警流程
- [ ]  任務排程執行結束時觸發 `TaskCompletedEvent` 進行分析或通知
- [ ]  實作 Fake EventBus 驗證每個事件類型是否能正常被觸發與處理
- [ ]  使用 `testLogger` 驗證事件是否被正確記錄
- [ ]  單元測試每個 Handler 接收到事件後的行為是否符合預期
- [ ]  可新增 `UserEvent`, `ReportEvent` 等事件類型
- [ ]  可補充每種事件對應 JSON Schema 供外部 API 使用
- [ ]  可設計通用 event validator 檢查結構正確性
- [ ]  建立 `docs/interfaces/configtypes.md` 說明文件
- [ ]  補充每一個 config struct 在 detectviz 中的用途與路徑對應
- [ ]  對齊其他 interface 文件格式與風格
- [ ]  將每個功能模組所需的設定集中管理
- [ ]  可清楚對應設定來源（如 JSON / YAML / ENV）
- [ ]  搭配 ConfigProvider 實現動態注入或切換
- [ ]  提供 Registry 與 Bootstrap 使用的統一結構
- [ ]  可建立對應 `_test.go` 測試配置反序列化行為
- [ ]  搭配 `testutil.LoadConfigFromYAML` 測試整體載入是否成功
- [ ]  支援 fallback 至預設值邏輯可單元測試驗證
- [ ]  若新增模組應同步建立對應 ConfigTypes 檔案（命名規則：`{module}_config.go`）
- [ ]  結構欄位建議皆標記 yaml/json tag
- [ ]  可未來對接 Config Schema 驗證或 UI 編輯介面
- [ ]  在 `/Users/zoe/Documents/github/detectviz/todo.md` 檔案最後新增一節，標題為 `# TODO 待補實作與修正項目清單（來自 detectviz-source-code.md 分析）`。
- [ ]  於該節下依照模組分類整理以下內容，並補充每項的實作細節摘要：
- [ ]  engine.go：模組註冊與啟動核心控制器，對應 modules.Engine。
- [ ]  dependencies.go：模組依賴宣告與啟動順序圖。
- [ ]  registry.go：提供 RegisterModule(), RegisterInvisibleModule()。
- [ ]  listener.go：註冊健康監控與全域 shutdown 機制。
- [ ]  runner.go：觸發 RunAll()，搭配 shutdown 時序。
- [ ]  server.go：整合 config、logger、module 與 HTTP Server。
- [ ]  runner.go：負責統一啟動流程與退出機制。
- [ ]  instrumentation.go：暴露 /metrics 與 /health endpoint，支援 profiling。
- [ ]  registry.go：註冊與掛載資源 CRUD 實作與 GVK 管理。
- [ ]  apis/host/register.go：定義 host 資源 GVK 註冊與 REST 實作。
- [ ]  apis/datasource/register.go：定義 datasource 資源 CRUD。
- [ ]  schemas/：每個資源對應的 schema YAML 或 JSON。
- [ ]  kinds/：使用 cue 驗證 schema 正確性。
- [ ]  plugin.go：plugin interface 定義（type、名稱、初始化等）。
- [ ]  manager/registry.go：註冊 plugins 並提供查詢。
- [ ]  manager/loader.go：從本地或 CDN 掃描 plugin 清單。
- [ ]  manager/process.go：啟動 plugin backend。
- [ ]  manager/lifecycle.go：plugin 啟動與關閉控制。
- [ ]  plugins/metric/flux/config.go：定義 Flux Plugin 設定結構與預設值。
- [ ]  plugins/metric/prom/config.go：定義 Prom Plugin 查詢參數。
- [ ]  plugins/notifier/email/config.go：定義 Email 通知格式與驗證。
- [ ]  plugins/notifier/slack/config.go：Slack webhook 與格式設定。
- [ ]  plugins/notifier/webhook/config.go：Generic webhook 自定義結構。
- [ ]  internal/adapters/eventbus/alert.go 測試案例尚未建立。
- [ ]  internal/plugins/eventbus/* 所有插件 handler 測試缺失。
- [ ]  internal/test/plugins/：應建立 plugin 驗證測試樣板。
- [ ]  pkg/ifaces/event/… 應補 mock 與泛用事件 payload 檢驗。
- [ ]  internal/test/testutil/assert_logger.go 功能可再擴充（包含結構化 log 比對）。
- [ ]  docs/interfaces/modules.md：模組生命週期架構說明與 interface 規範。
- [ ]  docs/interfaces/plugins.md：Plugin 管理與自定註冊機制說明。
- [ ]  在 `todo.md` 中每個頂層項目標題後補上對應「參考歷史紀錄」的行數說明，例如「📎 參考說明：詳見《參考歷史紀錄》第 3–95 行」
- [ ]  修改如下標題區段，補上註解：
- [ ]  在 `/Users/zoe/Documents/github/grafana/grafana/contribute/backend/communication.md` 檔案中，每一段英文說明下方加上繁體中文翻譯，保持 Markdown 格式不變。
- [ ]  程式碼區塊（```go 等）不需翻譯。
- [ ]  所有標題（例如 `## Commands and queries`）下方加上中文翻譯，使用全形標點。
- [ ]  範例區塊、Note、Tip 等提示說明亦需翻譯內容。
- [ ]  移除每段英文原文，只保留繁體中文翻譯。
- [ ]  將每段翻譯集中放在對應的標題下方，維持原有 Markdown 結構與段落層次。
- [ ]  程式碼區塊（```go 等）保留不變。
- [ ]  在每段繁體中文翻譯上方保留原文內容，將目前只剩中文的段落補上對應英文原文。
- [ ]  所有程式碼區塊不需修改。
- [ ]  已有中英文對照的部分可保持不變。
- [ ]  將所有標題（如 `## Commands and queries`）改為 `## Commands and queries（命令與查詢）` 形式，即在標題右側加上繁體中文翻譯，保留原有格式。
- [ ]  僅修改標題，不動內文與段落結構。
- [ ]  將所有中英文段落重新排序，使英文原文在上、繁體中文翻譯在下。
- [ ]  每段英文原文（段落或註解）下方緊接著其對應的翻譯，保持一致結構。
- [ ]  標題行（#、##、###）已處理過，無需變更。
- [ ]  保留原有程式碼區塊順序。
- [ ]  為 `/Users/zoe/Documents/github/grafana/grafana/contribute/backend/database.md` 中所有段落新增繁體中文翻譯，置於英文段落下方，保留原文與 Markdown 結構。
- [ ]  標題格式改為中英文並列，例如 `## SQLStore（SQL 資料庫存取服務）`
- [ ]  程式碼區塊不做任何修改。
- [ ]  找到 `/Users/zoe/Documents/obsidian/event-dispatcher-架構與範例.md`，將內容補充如下：
- [ ]  Event Dispatcher 是一種將「事件產生者」與「事件處理者」解耦的架構設計模式。
- [ ]  透過介面定義事件分派器與處理器，達到低耦合、高可測性與高擴充性。
- [ ]  常與 Adapter 模式搭配，用於處理告警、審計、通知等可插拔流程。
- [ ]  模組之間需要傳遞但不應直接依賴對方邏輯，例如：告警觸發後通知、審計紀錄。
- [ ]  替代全域 bus、registry 或 observer 等難以控制的全域共享機制。
- [ ]  測試中希望 mock 處理邏輯，避免副作用。
- [ ]  [[plugin-interface設計]]
- [ ]  [[detectviz-模組邊界原則]]
- [ ]  每個 handler 應實作單一職責，如：寫入 DB、發送通知、餵入向量資料庫。
- [ ]  Dispatcher 本身可由 App 層注入依賴，方便做單元測試與 mock。
- [ ]  若結合事件序列化（如 Kafka）可擴展為跨服務事件架構（EDA）。
- [ ]  在 `/Users/zoe/Documents/obsidian/README-grafana.md` 中每一個 `pkg/services/xxx/` 條目的右側補充一行備註，標示對應 Detectviz 的建議目錄路徑。
- [ ]  格式為：「➡️ Detectviz: internal/xxx/」或「➡️ Detectviz: pkg/xxx/」或「❌ 不建議遷移」，以便後續對照與遷移。
- [ ]  保留原有內容與排序，僅補充備註行，不刪除或調整任何原文。
- [ ]  將 `/Users/zoe/Documents/github/detectviz/開發規範.md` 內容整理為一份「Detectviz 開發規範總覽」，格式為 Markdown，並包含以下區塊順序：
- [ ]  整理後加標題 `# Detectviz 開發規範總覽`，方便合併到 README.md 使用。
- [ ]  移除原本的表格樣式，改用清單或子標題。
- [ ]  不要加入 emoji 或裝飾性標記，保持格式一致與簡潔。
- [ ]  將 `README.md` 中所有與「後端開發規範」、「前端開發規範」、「模組架構」、「事件系統策略」、「模組延伸」、「整合清單」等標題區段，統一移動至文件最下方。
- [ ]  移動順序如下：
- [ ]  同時刪除 `Detectviz 開發規範總覽` 的重複標題（只保留一份），並確認所有清單與格式仍然正確。
- [ ]  在 `README.md` 的最末端加入以下整合內容，並以標題 `# Detectviz 文件彙整（初版集中版）` 開始：
- [ ]  `apps/`: 負責路由、啟動與 UI
- [ ]  `internal/`: 實作 interface，封裝業務邏輯
- [ ]  `pkg/iface/`: 所有模組的抽象接口
- [ ]  `pkg/infra/`: 共用實作（log、redis、http client 等）
- [ ]  `plugins/`: 實作對應 interface 的可插拔模組
- [ ]  每個功能一個 interface，集中於 `pkg/iface/`
- [ ]  命名格式：`XService`, `XClient`
- [ ]  實作集中於 internal 或 plugins，可測試可 mock
- [ ]  internal 不跨引用，僅透過 iface 抽象注入
- [ ]  每個模組放於獨立 internal 子目錄，包含 `interface.go`、`service.go`
- [ ]  如需 REST API、事件、指令，獨立 `handler.go`、`event.go`、`cmd.go`
- [ ]  避免模組間 import，改由 `iface` 解耦
- [ ]  plugins 放於根目錄 `/plugins`
- [ ]  不得引用 `internal/`
- [ ]  可由 app 掃描 plugins 並注入
- [ ]  建議實作 `Manifest()` 方法提供 metadata
- [ ]  plugins 應依 interface 實作，不依賴 internal
- [ ]  可由 PluginRegistry 管理並支援動態註冊
- [ ]  每個 plugin 獨立模組，具備自我描述能力
- [ ]  main.go：負責 DI 組裝與啟動
- [ ]  routes.go：註冊 HTTP handler
- [ ]  handler/：每個模組 HTTP API
- [ ]  web/：layout/partials/pages
- [ ]  `docs/architecture-overview.md`
- [ ]  `docs/development-guidelines.md`
- [ ]  `docs/interface-contract.md`
- [ ]  `docs/plugins-guide.md`
- [ ]  `docs/app-template-guide.md`
- [ ]  這段內容將插入在原 `README.md` 檔案的最下方，作為集中版文件附錄。
- [ ]  將目前 `README.md` 中重複出現的模組設計說明（如架構分層、app/pkg/internal 說明、模組延伸與範例）做以下整併優化：
- [ ]  在 `README.md` 中的「Detectviz 文件彙整（初版集中版）」區段下方，新增小節 `## 平台架構原則與分層定義`，並加入以下內容：
- [ ]  `apps/`: 驅動整個架構，負責依需求組裝模組，提供 REST API 與 HTMX 前端畫面
- [ ]  `internal/`: 專屬 Detectviz 的應用邏輯與事件流模組，不可被其他 repo 匯入
- [ ]  `pkg/`: 通用工具、client、抽象 interface，支援跨模組與外部重用，應無應用邏輯耦合
- [ ]  `plugins/`: 可插拔模組，實作 interface 並可由 app 層注入使用
- [ ]  此段內容應插入於文件中 `## Detectviz 文件彙整（初版集中版）` 區塊內，作為繼續擴充的規範描述部分。
- [ ]  請保留標題順序一致性，並依照 markdown 標準語法與排版。
- [ ]  在 `pkg/` 目錄中，建立 `ifaces/` 子目錄，並依以下分群建立檔案：
- [ ]  更新 `pkg/config/` 中任一 `LoadConfig()`、`setting.Cfg` 相關使用方式，使其符合 `ConfigProvider` interface。
- [ ]  更新 `pkg/infra/log/`、`localcache/`、`httpclient/` 等模組中註解：這些為 `ifaces/` 的預設實作。
- [ ]  在 `pkg/config/default.go` 中新增一個實作 `ConfigProvider` 介面的結構 `defaultProvider`。
- [ ]  實作以下方法：`Get`、`GetInt`、`GetBool`、`GetOrDefault`、`Reload`。
- [ ]  加入建構函式 `NewDefaultProvider`。
- [ ]  在 `pkg/ifaces/config/config.go` 中新增 `ConfigProvider` interface，內容如下：
- [ ]  在 `internal/bootstrap/init.go` 中新增初始化設定，注入 `ConfigProvider` 介面。
- [ ]  插入以下內容：
- [ ]  在 `internal/alert/alert.go` 中新增以下內容，定義注入用的 `ConfigProvider` 與初始化函式：
- [ ]  在 `README.md` 中 `開發規範（後端 Golang）` 區段的下方，新增一段子標題 **「設定模組（ConfigProvider）設計原則」**，並補上以下內容：
- [ ]  interface 定義於：`pkg/ifaces/config/config.go`
- [ ]  預設實作於：`pkg/config/default.go`
- [ ]  啟動注入點：`internal/bootstrap/init.go`
- [ ]  統一設定入口
- [ ]  可 hot-reload（如未來加入 watch 機制）
- [ ]  可支援多來源（ENV、YAML、遠端 Config Center）
- [ ]  支援 Mock，便於單元測試
- [ ]  在 `docs/interfaces/config.md` 檔案中新增以下內容：
- [ ]  環境變數查詢
- [ ]  內部 map 快取（後續可擴充 YAML / DB / 遠端來源）
- [ ]  解耦設定來源與業務邏輯
- [ ]  避免全域變數與設定硬編碼
- [ ]  提供 hot-reload 可能性（支援 future extensibility）
- [ ]  易於 mock / 測試
- [ ]  將現有 `README.md` 重構為「平台總覽 + 導引」，並保留技術特色與快速導覽。
- [ ]  用精簡描述取代詳細規範，轉而導引至 `docs/` 目錄下的說明文件。
- [ ]  [架構圖與分層總覽](docs/architecture-overview.md)
- [ ]  [開發規範（Golang）](docs/develop-guide.md)
- [ ]  [介面設計與契約定義](docs/interface-contract.md)
- [ ]  [Plugin 設計與載入規則](docs/plugins-guide.md)
- [ ]  [App 模板建立流程](docs/app-template-guide.md)
- [ ]  [設定模組 ConfigProvider](docs/interfaces/config.md)
- [ ]  Clean Architecture（分層/解耦/可測）
- [ ]  Golang + HTMX SSR
- [ ]  Redis Stream 作為事件匯流排
- [ ]  多 Plugin 動態注入與註冊機制
- [ ]  ConfigProvider 介面化設定支援熱重載
- [ ]  支援獨立 App，內建前後端模組組裝
- [ ]  可插拔模組（plugin）+ interface 驅動
- [ ]  熱部署與 mock
- [ ]  plugin 掃描與版本註冊
- [ ]  App 內部模組皆放於 internal，僅 app 層可引用
- [ ]  高複用模組抽象於 pkg/，可跨 app / plugin 重用
- [ ]  在 `/Users/zoe/Documents/github/grafana/grafana/grafana-contribute.md` 中，針對整段說明「Grafana 是如何受 Kubernetes 啟發，並建立 Resource API 模型來取代 Legacy API」的段落，加上自然流暢的繁體中文說明。
- [ ]  每段英文段落下方，加入對應的繁體中文說明（非逐字翻譯，而是以解釋或補充為主，讓讀者理解設計意圖）。
- [ ]  對於專業術語（如 Resource API、Namespace、Unified Storage、Reconciler、Admission Webhook 等），加上括號註釋說明。
- [ ]  請從檔案開頭的 `# 受 Kubernetes 啟發的 Grafana 後端架構` 起，直到 `## 5. So does it all mean I can point kubectl directly at the Grafana server and use it to create dashboards?` 為止。
- [ ]  不修改原始英文內容，只補充繁體中文說明於下方（保留原文段落，對齊 Markdown 結構）。
- [ ]  找到段落標題 `### 告警事件的「編排者」與「中心樞紐」模組 (internal/alert/ 目錄)`
- [ ]  將其下方原本的結構圖：
- [ ]  將 `/pkg/iface.go` 補充為介面集中定義檔案，新增以下 interface 並加上清楚的繁體中文註解：
- [ ]  在 `pkg/iface/` 目錄中新增以下 interface 定義檔案，並為每個介面加上完整的繁體中文註解，目的是讓所有 internal 模組都可透過依賴注入方式引用共用元件。
- [ ]  在 `pkg/iface/` 目錄中建立以下 interface 檔案，並補充繁體中文註解以利實作與後續模組引用：
- [ ]  將 `/pkg/iface/README.md` 中原本只有 `env.go` 的範例內容，補充完整所有已建立 interface 的檔案說明與註解，並用條列格式列出。
- [ ]  在 `pkg/iface/README.md` 中補上以下三個 interface 類型的區塊，包含說明與繁體中文註解：
- [ ]  將 `configs/detectviz.conf` 內容依據 `README.md` 的系統架構與模組說明進行重構，包含以下調整：
- [ ]  在 `view/components/` 目錄下的 `layout.templ` 中新增或更新以下內容，根據 README.md 中描述的 AdminLTE 結構建立畫面 layout：
- [ ]  確保使用 class 名稱符合 AdminLTE 4 結構，如 `.wrapper`, `.sidebar`, `.content-wrapper`, `.navbar` 等。
- [ ]  保留 HTMX + templ 的區塊語法結構，並使用 `{{ block "content" . }}` 作為主要插槽。
- [ ]  在 `<head>` 區塊加入：
- [ ]  在 `<body>` 中插入表格顯示區塊：
- [ ]  在 `<script>` 中加入以下初始化 Tabulator 的邏輯：
- [ ]  在文件開頭新增以下說明段落，用於取代原本的收集器建議說明：
- [ ]  移除或取代文件中所有提及 `opentelemetry-collector` 或 `collector-contrib` 的推薦語句，改為建議使用 Grafana Alloy，並補充其涵蓋模組與相容格式（Prometheus Config / OTEL YAML）。
- [ ]  若原文件中有任何 “如何安裝 OTEL Collector” 的段落，改為新增指向 Alloy 的安裝說明連結，例如：
- [ ]  在 `alloy-config.yaml` 中新增 Alloy 的基本設定，支援 OTLP、Prometheus、Loki、Tempo，作為 observability pipeline，預設以 HTTP 接收資料並 forward 至本機端服務。
- [ ]  註：你可以根據實際使用的 port、資料來源調整 `targets`、`endpoint` 等項目。
- [ ]  在 `/Users/zoe/Documents/github/detectviz/alloy-devkit.md` 的 `## alloy-config.yaml 範例` 之後新增以下段落：
- [ ]  將原始 `README.md` 全面改寫為綜合我們的完整規劃與討論結果，涵蓋系統定位、模組化設計、建構方式、RAG 與 LLM 整合等。
- [ ]  替換整份內容如下：
- [ ]  **事件導向的監控與自動化平台**：整合 metrics、logs、alerts、actions
- [ ]  **模組化部署**：支援多場域異構部署、熱插拔模組、組裝式執行
- [ ]  **AI 整合平台**：導入 RAG（Retrieval-Augmented Generation）與 LLM 模組，支援告警摘要、異常說明與建議生成
- [ ]  **Telegraf 作為資料收集引擎**（SNMP / MODBUS / CLI / API）
- [ ]  **所有功能皆為 plugin/microservice 模組**
- [ ]  **使用 pages.yaml 編排模組配置**
- [ ]  **由 Orchestrator 控制模組生命週期與狀態回報**
- [ ]  **模組間通訊使用 Redis Pub/Sub（可替換 Kafka/NATS）**
- [ ]  **整合 Prometheus metrics、Zap 結構化日誌、Loki log 收集**
- [ ]  所有模組皆可作為 plugin 載入與熱部署
- [ ]  使用 `plugin-manager` 控制 Start / Stop / Reload
- [ ]  統一 Plugin Interface：
- [ ]  LLM 模型建議使用：Ollama（mistral 7B）、或未來導入 NVIDIA NIM
- [ ]  向量資料庫建議使用 Qdrant，本地部署即可
- [ ]  支援語意查詢與摘要：
- [ ]  `internal/config/`：koanf 組態載入
- [ ]  `internal/logger/`：zap + trace_id 支援
- [ ]  `internal/pubsub/`：Redis EventBus 抽象
- [ ]  `internal/metrics/`：Prometheus exporter
- [ ]  `pluginmanager/`：模組控制主體
- [ ]  `pages.yaml`：節點組態總表
- [ ]  `scripts/gen-telegraf-conf.sh`：根據配置產生 telegraf.conf
- [ ]  `dashboards/`：儀表板 JSON
- [ ]  `web/`：HTMX 前端 + Grafana iframe 整合 + API 狀態頁
- [ ]  建議每台 VM 明確分工（web / db / dev / llm）
- [ ]  LLM VM 建議分配：8 vCPU / 24GB RAM / 100GB disk（CPU 模型推論）
- [ ]  所有模組支援 status API，模組運作情況可由 orchestrator 統一回報
- [ ]  config 統一由 `.env` + `pages.yaml` 決定模組啟用、plugin 清單、主機識別
- [ ]  在 `README.md` 的「建置順序建議」章節之下，新增一節 **「📂 核心模組與 .go 檔導引」**。
- [ ]  新增內容如下，格式一致並對齊現有項目層級：
- [ ]  將目前的 plugins/services 架構進行重構，將 services 類模組依功能劃分為 processors 或 outputs。
- [ ]  具體修改如下：
- [ ]  在 `/detectviz/detectviz.md` 檔案中，針對 plugin 架構進行全面補充，補上所有實際存在的模組與檔案，並對照 `Telegraf` plugin 類型：inputs / processors / aggregators / outputs。
- [ ]  每一類 plugin 底下以模組為單位，列出其對應的 `.go` 檔與 init 檔、sample.conf、testdata 等相關資源。
- [ ]  新增下列內容並補齊缺漏：
- [ ]  alert-rule
- [ ]  collector
- [ ]  placeholder
- [ ]  anomaly
- [ ]  alert
- [ ]  redis
- [ ]  influxdb
- [ ]  mysql
- [ ]  loki
- [ ]  notifier
- [ ]  eventlog
- [ ]  automation
- [ ]  llm
- [ ]  reporter
- [ ]  重新整理 `/detectviz/detectviz.md` 的整體結構，明確補上：
- [ ]  將目錄層級與說明條列清楚，並保留 plugins 的分類方式與 plugin 檔案清單
- [ ]  在 `detectviz.md` 的末尾新增一節「## 開發說明與範例」，對每個主要目錄與典型檔案的用途做說明，並附上具體範例（目的是讓 Cursor IDE 補全能正確聚焦且不會遺漏必要細節）
- [ ]  新增內容如下：
- [ ]  `plugin.go`: Plugin 結構與邏輯主體
- [ ]  `init.go`: 進行 plugin 註冊
- [ ]  `sample.conf`: 此 plugin 的樣板設定檔
- [ ]  `testdata/`: 測試輸入與期望輸出資料夾（可選）
- [ ]  提供 `llmClient` 的呼叫包裝
- [ ]  接收 AlertEvent 並生成自然語言摘要
- [ ]  `pluginmanager/manager.go`: 管理 plugins 的註冊、啟動、狀態
- [ ]  `pubsub/interface.go`: 定義 EventBus 抽象接口，支援 Redis 或 memory backend
- [ ]  `logger/logger.go`: 封裝 zap 並提供 WithTrace() 功能
- [ ]  `apps/viot-fab/main.go`：代表工廠節點，會讀取 `pages.yaml` 並註冊模組
- [ ]  `apps/viot-dc/main.go`：代表中控節點，整合彙整後的告警與事件流
- [ ]  `exports/`: 儲存系統輸出內容，如報表、查詢結果（Markdown, CSV, JSON）
- [ ]  `embeddings/`: 儲存向量化結果（.jsonl）與 LLM RAG 需要的中繼資料
- [ ]  5 筆 Critical
- [ ]  發生時間集中在 11:00 - 11:30
- [ ]  建議巡檢 RACK A1-A3
- [ ]  將 `detectviz.md` 中「開發說明與範例」改寫為「開發節點順序與範例」，並依照建議的實作順序重新排序與說明。
- [ ]  每個階段補上：「目標」、「建議檔案」、「實作範例」
- [ ]  `internal/config/loader.go`：讀取 `.env` 與 `pages.yaml`
- [ ]  `internal/pluginmanager/manager.go`：掛載與控制 plugin
- [ ]  `internal/pubsub/*.go`：定義與實作 Redis / Memory EventBus
- [ ]  `internal/logger/logger.go`：封裝 zap 並支援 WithTrace
- [ ]  `internal/metrics/prometheus.go`：暴露 plugin 狀態與統計資訊
- [ ]  `plugins/inputs/alert-rule/`: 根據 YAML 規則產出 AlertEvent
- [ ]  `plugins/inputs/collector/snmp/`: 模擬 Telegraf 資料輸入
- [ ]  `plugins/processors/anomaly/`: 時間序列異常檢測（如 Prophet）
- [ ]  `plugins/processors/alert/`: 分級與條件篩選邏輯（如 Critical / Warning）
- [ ]  `outputs/eventlog`：記錄 AlertEvent
- [ ]  `outputs/notifier`：通知管道（LINE, Webhook）
- [ ]  `outputs/llm`：將事件摘要輸出成自然語言
- [ ]  `outputs/reporter`：每日彙整報告與建議輸出
- [ ]  `pages.yaml`: 載入所有 plugin 順序與對應 config
- [ ]  `profiles/alert-profiles.yaml`: 定義告警條件
- [ ]  `schemas/alert_event.schema.json`: AlertEvent 標準格式定義
- [ ]  `apps/viot-fab/main.go`: 工廠節點模擬與測試
- [ ]  `apps/viot-dc/main.go`: 中控節點，彙總告警並串接 llm + reporter
- [ ]  `exports/reports/*.md`: 報表與摘要輸出
- [ ]  `embeddings/*.jsonl`: 儲存嵌入向量結果，供 RAG 模型使用
- [ ]  在 `detectviz.md` 中，針對每個核心目錄與子目錄補充具體的「開發規格與建議事項」，讓實作時能避免遺漏。
- [ ]  於「## 目錄結構與功能說明」區段下方，新增一節說明如下：
- [ ]  每個 YAML/JSON 組態都應支援 schema 驗證（搭配 `/schemas/` 定義）
- [ ]  所有 `pages.yaml` 中的 plugin 名稱應對應 `pluginmanager` 註冊名稱
- [ ]  profiles 應分為：alert-profiles.yaml（閾值與條件）、llm-prompts.yaml（語意模板）
- [ ]  每個 plugin 需實作 Plugin interface 並註冊於 `init.go`
- [ ]  結構建議：
- [ ]  請避免在 plugin 中直接依賴特定 bus 實作，應注入 EventBus 介面
- [ ]  輸入與處理 plugin 應使用 AlertEvent 結構傳遞
- [ ]  `pluginmanager` 必須支援動態註冊、熱啟動與狀態查詢
- [ ]  `logger` 應支援 zap 結構化 log 並具備 trace_id/context-aware logger
- [ ]  `pubsub` 建議實作 memory 與 Redis 兩種介面，支援 fallback 測試模式
- [ ]  每個場域/節點應有獨立 main.go，透過 `pages.yaml` 決定載入模組
- [ ]  節點名稱應自動注入到 event tag 或 logs，用於分群與中控統計
- [ ]  每次 report 產出應含報表時間與來源場域資訊
- [ ]  可產出格式：markdown, HTML（後續可轉 PDF）
- [ ]  每筆向量資料應含 metadata（如告警類型、timestamp、severity）
- [ ]  向量檔案可為 JSONL 或使用 Qdrant-compatible 格式
- [ ]  命名方式：`{場域}-{類型}-{功能}.json`（例如：fab1-power.json）
- [ ]  可搭配 `apps/viot-fab` 載入指定面板
- [ ]  用於展示簡易 UI 或內嵌 Grafana，可整合 `/exports/` 產出
- [ ]  可支援 minimal htmx 模組用於查詢告警、事件統計
- [ ]  在 `detectviz.md` 的「開發節點順序與範例」區段中，於 `plugins/outputs` 小節下補充 `llm` 與 `reporter` 模組的開發範例，包含 Plugin 結構、事件處理與實際用途，協助開發時不遺漏重要邏輯。
- [ ]  追加內容如下：
- [ ]  Critical 告警：12 筆
- [ ]  主要發生於 Phase A 與 Rack 1~3
- [ ]  建議巡檢時間段：09:00 ~ 11:00
- [ ]  在 `detectviz.md` 的開發節點與 plugin 範例區段後，新增一節說明 `AlertEvent` 結構定義與其流動路徑，供開發者實作與 trace 時參考。
- [ ]  追加內容如下：
- [ ]  每個模組皆應透過 pubsub 傳遞 `AlertEvent`，並記錄處理後狀態
- [ ]  `Handled` 欄位可由 downstream plugin 標記是否已完成通知/紀錄/摘要
- [ ]  在 `detectviz.md` 的 `configs/` 區段中，補充 `.env` 與 `pages.yaml` 的範例完整內容，用於開發參考與部署一致性。
- [ ]  在 `detectviz.md` 的 `configs/` 區段下方補充 `alert-profiles.yaml` 與 `sample.conf` 範例，讓開發者能理解格式與定義方式。
- [ ]  指標：{{.Metric}}
- [ ]  數值：{{.Value}}
- [ ]  描述：{{.Message}}
- [ ]  場域：{{.Tags.factory}} {{.Tags.rack}} {{.Tags.phase}}
- [ ]  在 `detectviz.md` 文件最後新增「自動化建構與驗證建議」區段，補充未來開發應納入的 CLI 工具與檢查機制，確保 `.yaml`、`.conf`、`plugin.go` 三者間一致性，並支援擴充。
- [ ]  在 `detectviz.md` 的 `alert-profiles.yaml` 範例中，為範例規則加上 `duration` 欄位說明，代表異常需持續多久才成立。
- [ ]  在 `outputs.llm` plugin 說明區補充 `.prompt.go` 用途，並建議建立單獨檔案管理 prompt 渲染邏輯以分離 concern。
- [ ]  `prompt := renderPrompt(o.PromptTmpl, evt)`
- [ ]  補充 `.env` 的完整欄位範例，包括與 plugins、logs、metrics、RAG 模型等相關設定。
- [ ]  同時新增 `configs/llm-prompts.yaml` 支援可配置化 prompt 模板，供 outputs.llm 模組引用。
- [ ]  在 `detectviz.md` 的 `internal/pubsub` 區段下新增一節說明模組間使用 PubSub 的設計目的、介面說明、使用範例與常見 channel 命名慣例。
- [ ]  並補充 `.env` 應新增欄位 `PUBSUB_BACKEND`, `REDIS_URL`，已支援 redis 訊息傳遞。
- [ ]  `memory.go`：僅供本地測試用
- [ ]  `redis.go`：可併發、多節點生產者/消費者環境使用
- [ ]  在 `detectviz.md` 中新增「Redis Streams 架構補充說明」區段。
- [ ]  補上 `.env` 中 Redis Streams 建議配置欄位。
- [ ]  說明 Redis Streams 的模組對應與 consumer group 配置方式。
- [ ]  提供 `internal/pubsub/redis_stream.go` 初始範本路徑與設計要點建議。
- [ ]  事件系統已支援 Redis Streams 模式，具備可靠交付能力
- [ ]  每個模組應指定自身的 stream 名稱與 consumer group
- [ ]  預設以 `stream.event_name` + `group.plugin_type` 為命名規則
- [ ]  plugins 應呼叫 redis_stream.Publish / Subscribe 並手動 XACK
- [ ]  調整 `detectviz.md` 中 **「## 目錄結構與功能說明」** 區塊，讓整體說明更一致、分類更清晰，並補上每個目錄的功能定位與常見子項。
- [ ]  統整重點為：
- [ ]  `configs/`
- [ ]  `plugins/`
- [ ]  `internal/`
- [ ]  `apps/`
- [ ]  `exports/`
- [ ]  `embeddings/`
- [ ]  `dashboards/`
- [ ]  `web/`
- [ ]  `scripts/`
- [ ]  更新 `detectviz.md` 的「## 目錄結構與功能說明」區塊，讓說明更一致、分類清楚，順序依架構層次與邏輯性調整如下：
- [ ]  `configs/`
- [ ]  `plugins/`
- [ ]  `internal/`
- [ ]  `apps/`
- [ ]  `exports/`
- [ ]  `embeddings/`
- [ ]  `dashboards/`
- [ ]  `web/`
- [ ]  `scripts/`
- [ ]  移除獨立的「## Redis Streams 架構補充說明」章節
- [ ]  將 Redis Streams 說明內容整合到下列兩處：
- [ ]  更新結構與描述讓說明更集中於實作對應位置